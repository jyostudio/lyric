class t{constructor(){this.state="future",this.text="",this.duration=0,this.progress=0,this.singleLine=!1,this.lineNo=0}get hasTiming(){return!this.singleLine&&(this.duration||0)>0}}class e{static updateByTime(t,e){return t.setCurrentTime(e)}static computeActiveWordIndex(t){if(!t||!t.words||0===t.words.length)return-1;try{if(!gr.supportsPerWord(t))return-1}catch{}const e=t.words;let n=e.findIndex(t=>"current"===t.state);if(-1!==n)return n;for(let t=e.length-1;t>=0;t--)if("past"===e[t].state)return t;return 0}static computeScrollTarget(t,e,n,r){if(!t.length||n<0||n>=t.length)return 0;const s=t.slice();if(r&&"number"==typeof r.activeIndex&&r.activeIndex>=0){const t=r.activeIndex,e=r.activeScale&&isFinite(r.activeScale)&&r.activeScale>0?r.activeScale:1;t>=0&&t<s.length&&1!==e&&(s[t]=(s[t]||0)/e)}let a=0;for(let t=0;t<n;t++)a+=(s[t]||0)+(e||0);return-a-(s[n]||0)/2}static computeTotalScrollableHeight(t,e,n){if(!t.length)return 0;const r=t.slice();if(n&&"number"==typeof n.activeIndex&&n.activeIndex>=0){const t=n.activeIndex,e=n.activeScale&&isFinite(n.activeScale)&&n.activeScale>0?n.activeScale:1;t>=0&&t<r.length&&1!==e&&(r[t]=(r[t]||0)/e)}return r.reduce((t,e)=>t+(e||0),0)+(t.length-1)*(e||0)}static computeScrollClamp(t,e,n=50,r){if(!t.length)return{min:0,max:0};const s=t.slice();if(r&&"number"==typeof r.activeIndex&&r.activeIndex>=0){const t=r.activeIndex,e=r.activeScale&&isFinite(r.activeScale)&&r.activeScale>0?r.activeScale:1;t>=0&&t<s.length&&1!==e&&(s[t]=(s[t]||0)/e)}return{min:-(this.computeTotalScrollableHeight(s,e)-(s[s.length-1]||0)/2)-n,max:-(s[0]||0)/2+n}}static calcScrollPercent(t,e,n,r){if(!e.length||t<0)return"0";const s=e.slice();if(r&&"number"==typeof r.activeIndex&&r.activeIndex>=0){const t=r.activeIndex,e=r.activeScale&&isFinite(r.activeScale)&&r.activeScale>0?r.activeScale:1;t>=0&&t<s.length&&1!==e&&(s[t]=(s[t]||0)/e)}let a=0;for(let e=0;e<t;e++)a+=(s[e]||0)+(n||0);const i=this.computeTotalScrollableHeight(s,n);return(i?a/i*100:0).toFixed(2)}}class n{constructor(){this.state="future",this.progress=0,this.renderProgress=0,this.no=0,this.startTime=0,this.duration=0,this.text="",this.words=[],this.lineNo=0,this.rowTexts=[],this.pseudoPerWord=!1}static get Empty(){const t=new n;return t.duration=1/0,t}hasPerWordTiming(){if(!0===this.pseudoPerWord)return!0;return(this.words||[]).some(t=>(t?.duration||0)>0&&!t.singleLine)}get primaryText(){return this.rowTexts&&this.rowTexts.length>0?this.rowTexts[0]||"":(this.text||"").split("\n")[0]||""}get secondaryText(){if(this.rowTexts&&this.rowTexts.length>1)return this.rowTexts[1]||"";return(this.text||"").split("\n")[1]||""}}const r=/^\[[^:]+:[^\]]*\]/,s=/^(\[(\d+),(\d+)\])/,a=/\[(\d+):(\d+)(?:[.:](\d+))?\]/,i=/\<(\d+)\>/,o=/\<\d+\>/,l=/\[([a-z#]+):([^\]]*)\]/i;class h{static{this.optionLastLyricIsInfinity=!1}static parse(t,e){let n="";n=e instanceof ArrayBuffer?new TextDecoder("utf-8").decode(e):e,n.split(/\r?\n/).forEach(e=>this.#t(t,e)),this.#e(t)}static#t(t,e){s.test(e)&&(e=this.#n(e)),r.test(e)&&(l.test(e)?this.#r(t,e):a.test(e)&&this.#s(t,e))}static#n(t){return t=(t=t.replace(s,(t,e,n)=>{const r=new Date(parseFloat(n));return`[${r.getMinutes()}:${r.getSeconds()}.${r.getMilliseconds()}]`})).replace(/\(0,(\d+)\)/gi,(t,e)=>`<${e}>`)}static#r(t,e){const n=l.exec(e);if(!n)return;const r=n[1].toLowerCase(),s=n[2]||"";switch(r){case"ar":case"au":case"ti":case"al":case"by":case"re":case"ve":case"key":case"sign":case"qq":case"id":case"hash":case"length":t.metadata.set(r,s);break;case"total":{const e=Math.floor(parseInt(s)/1e3+.5),n=String(Math.floor(e/60)).padStart(2,"0"),r=String(e%60).padStart(2,"0");t.metadata.set("length",`${n}:${r}`);break}case"offset":{let e=parseInt(s);isNaN(e)&&(e=0),t.metadata.set("offset",e);break}}}static#s(e,r){const s=[];let l,h=r;for(;l=a.exec(h);){const t=l[3]?parseInt(l[3].padEnd(3,"0")):0,e=1e3*(60*parseInt(l[1])+parseInt(l[2]))+t;s.push(e),h=h.replace(l[0],"")}let d=[];const c=h.split(o);c.shift();let f=0,u=h;for(;l=i.exec(u);){const e=new t;e.lineNo=1,e.duration=parseInt(l[1]),e.text=c[f++]??"",d.push(e),u=u.replace(l[0],"")}if(0===d.length){const e=new t;e.lineNo=1,e.singleLine=!0,e.text=h,d.push(e)}s.forEach(t=>{const r=new n;r.startTime=t,r.text=d.length>0?u:h,r.words=d,e.lines.push(r)})}static#e(t){let e=this.#a(t.lines);e=this.#i(e),this.#o(e),this.#l(e),this.#h(e,t),this.#d(e),t.lines.length=0,t.lines.push(...e)}static#a(t){const e=new Map;for(const n of t){const t=JSON.stringify(n);e.has(t)||e.set(t,n)}return Array.from(e.values())}static#i(t){const e=new Map;for(const n of t){const t=e.get(n.startTime);t?(t.text+="\n"+n.text,n.words.forEach(e=>e.lineNo=(t.words[0]?.lineNo??0)+1),t.words=t.words.concat(n.words)):e.set(n.startTime,n)}return Array.from(e.values())}static#o(t){t.sort((t,e)=>t.startTime-e.startTime)}static#l(t){t.forEach((t,e,n)=>{t.duration=n[e+1]?n[e+1].startTime-t.startTime:t.duration,t.no=e+1,t.rowTexts=t.text.split("\n"),t.rowTexts&&t.rowTexts.length>0&&(t.text=t.rowTexts[0]||"")})}static#h(t,e){if(0!==t.length)if(h.optionLastLyricIsInfinity||!e.metadata.has("length"))t[t.length-1].duration=1/0;else{const n=t[t.length-1],r=a.exec(`[${e.metadata.get("length")}]`);if(r){const t=r[3]?parseInt(r[3].padEnd(3,"0")):0,e=1e3*(60*parseInt(r[1]||"0")+parseInt(r[2]||"0"))+t;n.duration=e-n.startTime,n.duration<=0&&(n.duration=1/0)}else n.duration=1/0}}static#d(e){const n=(t,e)=>{const n=Math.max(1,e),r=Math.floor(t/n),s=new Array(n).fill(r);let a=t-r*n;for(let t=0;t<n&&a>0;t++,a--)s[t]+=1;return s};for(const r of e){const e=(r.words||[]).filter(t=>!t.singleLine&&(t.duration||0)>0),s=Number.isFinite(r.duration)&&(r.duration||0)>0,a=r.rowTexts&&r.rowTexts.length>0?r.rowTexts:r.text?r.text.split("\n"):[""],i=a.reduce((t,e)=>t+(Array.from(e||"").length>0?1:0),0),o=new Map;for(const t of e)o.set(t.lineNo||1,(o.get(t.lineNo||1)||0)+1);const l=Array.from(o.values()).every(t=>t<=1),h=e.length>0&&l&&e.length<=i;if(0!==e.length&&!h)continue;let d=s?Math.round(r.duration):0;if(!d&&e.length>0&&(d=e.reduce((t,e)=>Math.max(t,Math.max(0,Math.round(e.duration||0))),0)),!(d>0))continue;let c=0;if(!a[0]||0===Array.from(a[0]).length){const t=a.findIndex(t=>Array.from(t||"").length>0);c=t>=0?t:0}const f=a[c]||"",u=Array.from(f);if(0===u.length)continue;const _=n(d,u.length),g=[];for(let e=0;e<u.length;e++){const n=new t;n.text=u[e],n.duration=_[e]||0,n.singleLine=!1,n.lineNo=c+1,g.push(n)}g.length>0&&(r.words=g,a&&a.length>0&&(r.text=a[0]||""),r.pseudoPerWord=!0)}}}class d{static generate(t){if(!(t instanceof gr))throw new TypeError("参数 1 必须为 Lyric 实例");const e=[];t.metadata.forEach((t,n)=>{e.push(`[${n}:${t}]`)}),t.lines.forEach(t=>{const n=this.#c(t.startTime),r=t.rowTexts&&t.rowTexts.length>0?t.rowTexts:t.text?t.text.split("\n"):[""];for(let s=0;s<r.length;s++){const a=s+1;let i=r[s]||"";!(!0===t.pseudoPerWord)&&this.#f(t,a)&&(i=this.#u(t,a)),e.push(`${n} ${i}`)}});const n=e.join("\n");return(new TextEncoder).encode(n).buffer}static#c(t){const e=Math.floor(t/1e3),n=Math.floor(e/60),r=e%60,s=t%1e3;return`[${String(n).padStart(2,"0")}:${String(r).padStart(2,"0")}.${String(s).padStart(3,"0")}]`}static#f(t,e){return!(!t||!Array.isArray(t.words))&&t.words.some(t=>t&&t.lineNo===e&&!t.singleLine&&(t.duration||0)>0)}static#u(t,e){const n=(t.words||[]).filter(t=>t&&t.lineNo===e);if(0===n.length)return"";const r=n.find(t=>t.singleLine);return r?r.text||"":n.map(t=>`<${Math.max(0,Math.round(t.duration||0))}>${t.text||""}`).join("")}}class c{static generate(t){if(!(t instanceof gr))throw new TypeError("参数 1 必须为 Lyric 实例");const e=d.generate(t),n=new TextDecoder("utf-8").decode(e).replace(/<\d+>/g,"");return(new TextEncoder).encode(n).buffer}}class f extends Date{format(t){const e={"M+":this.getMonth()+1,"d+":this.getDate(),"H+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(const n in e)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,1===RegExp.$1.length?String(e[n]):("00"+e[n]).substr((""+e[n]).length)));return t}}function u(t){let e=t.length;for(;--e>=0;)t[e]=0}const _=256,g=286,p=30,w=15,m=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),b=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),x=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),y=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),k=new Array(576);u(k);const v=new Array(60);u(v);const A=new Array(512);u(A);const T=new Array(256);u(T);const E=new Array(29);u(E);const z=new Array(p);function S(t,e,n,r,s){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=s,this.has_stree=t&&t.length}let L,F,M;function $(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}u(z);const I=t=>t<256?A[t]:A[256+(t>>>7)],R=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},D=(t,e,n)=>{t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,R(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},U=(t,e,n)=>{D(t,n[2*e],n[2*e+1])},N=(t,e)=>{let n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1},Z=(t,e,n)=>{const r=new Array(16);let s,a,i=0;for(s=1;s<=w;s++)i=i+n[s-1]<<1,r[s]=i;for(a=0;a<=e;a++){let e=t[2*a+1];0!==e&&(t[2*a]=N(r[e]++,e))}},C=t=>{let e;for(e=0;e<g;e++)t.dyn_ltree[2*e]=0;for(e=0;e<p;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},B=t=>{t.bi_valid>8?R(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},O=(t,e,n,r)=>{const s=2*e,a=2*n;return t[s]<t[a]||t[s]===t[a]&&r[e]<=r[n]},P=(t,e,n)=>{const r=t.heap[n];let s=n<<1;for(;s<=t.heap_len&&(s<t.heap_len&&O(e,t.heap[s+1],t.heap[s],t.depth)&&s++,!O(e,r,t.heap[s],t.depth));)t.heap[n]=t.heap[s],n=s,s<<=1;t.heap[n]=r},j=(t,e,n)=>{let r,s,a,i,o=0;if(0!==t.sym_next)do{r=255&t.pending_buf[t.sym_buf+o++],r+=(255&t.pending_buf[t.sym_buf+o++])<<8,s=t.pending_buf[t.sym_buf+o++],0===r?U(t,s,e):(a=T[s],U(t,a+_+1,e),i=m[a],0!==i&&(s-=E[a],D(t,s,i)),r--,a=I(r),U(t,a,n),i=b[a],0!==i&&(r-=z[a],D(t,r,i)))}while(o<t.sym_next);U(t,256,e)},W=(t,e)=>{const n=e.dyn_tree,r=e.stat_desc.static_tree,s=e.stat_desc.has_stree,a=e.stat_desc.elems;let i,o,l,h=-1;for(t.heap_len=0,t.heap_max=573,i=0;i<a;i++)0!==n[2*i]?(t.heap[++t.heap_len]=h=i,t.depth[i]=0):n[2*i+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=h<2?++h:0,n[2*l]=1,t.depth[l]=0,t.opt_len--,s&&(t.static_len-=r[2*l+1]);for(e.max_code=h,i=t.heap_len>>1;i>=1;i--)P(t,n,i);l=a;do{i=t.heap[1],t.heap[1]=t.heap[t.heap_len--],P(t,n,1),o=t.heap[1],t.heap[--t.heap_max]=i,t.heap[--t.heap_max]=o,n[2*l]=n[2*i]+n[2*o],t.depth[l]=(t.depth[i]>=t.depth[o]?t.depth[i]:t.depth[o])+1,n[2*i+1]=n[2*o+1]=l,t.heap[1]=l++,P(t,n,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,e)=>{const n=e.dyn_tree,r=e.max_code,s=e.stat_desc.static_tree,a=e.stat_desc.has_stree,i=e.stat_desc.extra_bits,o=e.stat_desc.extra_base,l=e.stat_desc.max_length;let h,d,c,f,u,_,g=0;for(f=0;f<=w;f++)t.bl_count[f]=0;for(n[2*t.heap[t.heap_max]+1]=0,h=t.heap_max+1;h<573;h++)d=t.heap[h],f=n[2*n[2*d+1]+1]+1,f>l&&(f=l,g++),n[2*d+1]=f,d>r||(t.bl_count[f]++,u=0,d>=o&&(u=i[d-o]),_=n[2*d],t.opt_len+=_*(f+u),a&&(t.static_len+=_*(s[2*d+1]+u)));if(0!==g){do{for(f=l-1;0===t.bl_count[f];)f--;t.bl_count[f]--,t.bl_count[f+1]+=2,t.bl_count[l]--,g-=2}while(g>0);for(f=l;0!==f;f--)for(d=t.bl_count[f];0!==d;)c=t.heap[--h],c>r||(n[2*c+1]!==f&&(t.opt_len+=(f-n[2*c+1])*n[2*c],n[2*c+1]=f),d--)}})(t,e),Z(n,h,t.bl_count)},H=(t,e,n)=>{let r,s,a=-1,i=e[1],o=0,l=7,h=4;for(0===i&&(l=138,h=3),e[2*(n+1)+1]=65535,r=0;r<=n;r++)s=i,i=e[2*(r+1)+1],++o<l&&s===i||(o<h?t.bl_tree[2*s]+=o:0!==s?(s!==a&&t.bl_tree[2*s]++,t.bl_tree[32]++):o<=10?t.bl_tree[34]++:t.bl_tree[36]++,o=0,a=s,0===i?(l=138,h=3):s===i?(l=6,h=3):(l=7,h=4))},K=(t,e,n)=>{let r,s,a=-1,i=e[1],o=0,l=7,h=4;for(0===i&&(l=138,h=3),r=0;r<=n;r++)if(s=i,i=e[2*(r+1)+1],!(++o<l&&s===i)){if(o<h)do{U(t,s,t.bl_tree)}while(0!==--o);else 0!==s?(s!==a&&(U(t,s,t.bl_tree),o--),U(t,16,t.bl_tree),D(t,o-3,2)):o<=10?(U(t,17,t.bl_tree),D(t,o-3,3)):(U(t,18,t.bl_tree),D(t,o-11,7));o=0,a=s,0===i?(l=138,h=3):s===i?(l=6,h=3):(l=7,h=4)}};let Y=!1;const q=(t,e,n,r)=>{D(t,0+(r?1:0),3),B(t),R(t,n),R(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n};var Q=(t,e,n,r)=>{let s,a,i=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let e,n=4093624447;for(e=0;e<=31;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<_;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0})(t)),W(t,t.l_desc),W(t,t.d_desc),i=(t=>{let e;for(H(t,t.dyn_ltree,t.l_desc.max_code),H(t,t.dyn_dtree,t.d_desc.max_code),W(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*y[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e})(t),s=t.opt_len+3+7>>>3,a=t.static_len+3+7>>>3,a<=s&&(s=a)):s=a=n+5,n+4<=s&&-1!==e?q(t,e,n,r):4===t.strategy||a===s?(D(t,2+(r?1:0),3),j(t,k,v)):(D(t,4+(r?1:0),3),((t,e,n,r)=>{let s;for(D(t,e-257,5),D(t,n-1,5),D(t,r-4,4),s=0;s<r;s++)D(t,t.bl_tree[2*y[s]+1],3);K(t,t.dyn_ltree,e-1),K(t,t.dyn_dtree,n-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,i+1),j(t,t.dyn_ltree,t.dyn_dtree)),C(t),r&&B(t)},G={_tr_init:t=>{Y||((()=>{let t,e,n,r,s;const a=new Array(16);for(n=0,r=0;r<28;r++)for(E[r]=n,t=0;t<1<<m[r];t++)T[n++]=r;for(T[n-1]=r,s=0,r=0;r<16;r++)for(z[r]=s,t=0;t<1<<b[r];t++)A[s++]=r;for(s>>=7;r<p;r++)for(z[r]=s<<7,t=0;t<1<<b[r]-7;t++)A[256+s++]=r;for(e=0;e<=w;e++)a[e]=0;for(t=0;t<=143;)k[2*t+1]=8,t++,a[8]++;for(;t<=255;)k[2*t+1]=9,t++,a[9]++;for(;t<=279;)k[2*t+1]=7,t++,a[7]++;for(;t<=287;)k[2*t+1]=8,t++,a[8]++;for(Z(k,287,a),t=0;t<p;t++)v[2*t+1]=5,v[2*t]=N(t,5);L=new S(k,m,257,g,w),F=new S(v,b,0,p,w),M=new S(new Array(0),x,0,19,7)})(),Y=!0),t.l_desc=new $(t.dyn_ltree,L),t.d_desc=new $(t.dyn_dtree,F),t.bl_desc=new $(t.bl_tree,M),t.bi_buf=0,t.bi_valid=0,C(t)},_tr_stored_block:q,_tr_flush_block:Q,_tr_tally:(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(T[n]+_+1)]++,t.dyn_dtree[2*I(e)]++),t.sym_next===t.sym_end),_tr_align:t=>{D(t,2,3),U(t,256,k),(t=>{16===t.bi_valid?(R(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}};var X=(t,e,n,r)=>{let s=65535&t,a=t>>>16&65535,i=0;for(;0!==n;){i=n>2e3?2e3:n,n-=i;do{s=s+e[r++]|0,a=a+s|0}while(--i);s%=65521,a%=65521}return s|a<<16};const J=new Uint32Array((()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e})());var V=(t,e,n,r)=>{const s=J,a=r+n;t^=-1;for(let n=r;n<a;n++)t=t>>>8^s[255&(t^e[n])];return-1^t},tt={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},et={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:nt,_tr_stored_block:rt,_tr_flush_block:st,_tr_tally:at,_tr_align:it}=G,{Z_NO_FLUSH:ot,Z_PARTIAL_FLUSH:lt,Z_FULL_FLUSH:ht,Z_FINISH:dt,Z_BLOCK:ct,Z_OK:ft,Z_STREAM_END:ut,Z_STREAM_ERROR:_t,Z_DATA_ERROR:gt,Z_BUF_ERROR:pt,Z_DEFAULT_COMPRESSION:wt,Z_FILTERED:mt,Z_HUFFMAN_ONLY:bt,Z_RLE:xt,Z_FIXED:yt,Z_DEFAULT_STRATEGY:kt,Z_UNKNOWN:vt,Z_DEFLATED:At}=et,Tt=258,Et=262,zt=42,St=113,Lt=666,Ft=(t,e)=>(t.msg=tt[e],e),Mt=t=>2*t-(t>4?9:0),$t=t=>{let e=t.length;for(;--e>=0;)t[e]=0},It=t=>{let e,n,r,s=t.w_size;e=t.hash_size,r=e;do{n=t.head[--r],t.head[r]=n>=s?n-s:0}while(--e);e=s,r=e;do{n=t.prev[--r],t.prev[r]=n>=s?n-s:0}while(--e)};let Rt=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const Dt=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))},Ut=(t,e)=>{st(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,Dt(t.strm)},Nt=(t,e)=>{t.pending_buf[t.pending++]=e},Zt=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},Ct=(t,e,n,r)=>{let s=t.avail_in;return s>r&&(s=r),0===s?0:(t.avail_in-=s,e.set(t.input.subarray(t.next_in,t.next_in+s),n),1===t.state.wrap?t.adler=X(t.adler,e,s,n):2===t.state.wrap&&(t.adler=V(t.adler,e,s,n)),t.next_in+=s,t.total_in+=s,s)},Bt=(t,e)=>{let n,r,s=t.max_chain_length,a=t.strstart,i=t.prev_length,o=t.nice_match;const l=t.strstart>t.w_size-Et?t.strstart-(t.w_size-Et):0,h=t.window,d=t.w_mask,c=t.prev,f=t.strstart+Tt;let u=h[a+i-1],_=h[a+i];t.prev_length>=t.good_match&&(s>>=2),o>t.lookahead&&(o=t.lookahead);do{if(n=e,h[n+i]===_&&h[n+i-1]===u&&h[n]===h[a]&&h[++n]===h[a+1]){a+=2,n++;do{}while(h[++a]===h[++n]&&h[++a]===h[++n]&&h[++a]===h[++n]&&h[++a]===h[++n]&&h[++a]===h[++n]&&h[++a]===h[++n]&&h[++a]===h[++n]&&h[++a]===h[++n]&&a<f);if(r=Tt-(f-a),a=f-Tt,r>i){if(t.match_start=e,i=r,r>=o)break;u=h[a+i-1],_=h[a+i]}}}while((e=c[e&d])>l&&0!==--s);return i<=t.lookahead?i:t.lookahead},Ot=t=>{const e=t.w_size;let n,r,s;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-Et)&&(t.window.set(t.window.subarray(e,e+e-r),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),It(t),r+=e),0===t.strm.avail_in)break;if(n=Ct(t.strm,t.window,t.strstart+t.lookahead,r),t.lookahead+=n,t.lookahead+t.insert>=3)for(s=t.strstart-t.insert,t.ins_h=t.window[s],t.ins_h=Rt(t,t.ins_h,t.window[s+1]);t.insert&&(t.ins_h=Rt(t,t.ins_h,t.window[s+3-1]),t.prev[s&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=s,s++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<Et&&0!==t.strm.avail_in)},Pt=(t,e)=>{let n,r,s,a=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,i=0,o=t.strm.avail_in;do{if(n=65535,s=t.bi_valid+42>>3,t.strm.avail_out<s)break;if(s=t.strm.avail_out-s,r=t.strstart-t.block_start,n>r+t.strm.avail_in&&(n=r+t.strm.avail_in),n>s&&(n=s),n<a&&(0===n&&e!==dt||e===ot||n!==r+t.strm.avail_in))break;i=e===dt&&n===r+t.strm.avail_in?1:0,rt(t,0,0,i),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,Dt(t.strm),r&&(r>n&&(r=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+r),t.strm.next_out),t.strm.next_out+=r,t.strm.avail_out-=r,t.strm.total_out+=r,t.block_start+=r,n-=r),n&&(Ct(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(0===i);return o-=t.strm.avail_in,o&&(o>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=o&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-o,t.strm.next_in),t.strstart),t.strstart+=o,t.insert+=o>t.w_size-t.insert?t.w_size-t.insert:o),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),i?4:e!==ot&&e!==dt&&0===t.strm.avail_in&&t.strstart===t.block_start?2:(s=t.window_size-t.strstart,t.strm.avail_in>s&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,s+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),s>t.strm.avail_in&&(s=t.strm.avail_in),s&&(Ct(t.strm,t.window,t.strstart,s),t.strstart+=s,t.insert+=s>t.w_size-t.insert?t.w_size-t.insert:s),t.high_water<t.strstart&&(t.high_water=t.strstart),s=t.bi_valid+42>>3,s=t.pending_buf_size-s>65535?65535:t.pending_buf_size-s,a=s>t.w_size?t.w_size:s,r=t.strstart-t.block_start,(r>=a||(r||e===dt)&&e!==ot&&0===t.strm.avail_in&&r<=s)&&(n=r>s?s:r,i=e===dt&&0===t.strm.avail_in&&n===r?1:0,rt(t,t.block_start,n,i),t.block_start+=n,Dt(t.strm)),i?3:1)},jt=(t,e)=>{let n,r;for(;;){if(t.lookahead<Et){if(Ot(t),t.lookahead<Et&&e===ot)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=Rt(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-Et&&(t.match_length=Bt(t,n)),t.match_length>=3)if(r=at(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=Rt(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!==--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=Rt(t,t.ins_h,t.window[t.strstart+1]);else r=at(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(Ut(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===dt?(Ut(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(Ut(t,!1),0===t.strm.avail_out)?1:2},Wt=(t,e)=>{let n,r,s;for(;;){if(t.lookahead<Et){if(Ot(t),t.lookahead<Et&&e===ot)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=Rt(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-Et&&(t.match_length=Bt(t,n),t.match_length<=5&&(t.strategy===mt||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){s=t.strstart+t.lookahead-3,r=at(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=s&&(t.ins_h=Rt(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!==--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,r&&(Ut(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(r=at(t,0,t.window[t.strstart-1]),r&&Ut(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=at(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===dt?(Ut(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(Ut(t,!1),0===t.strm.avail_out)?1:2};function Ht(t,e,n,r,s){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=s}const Kt=[new Ht(0,0,0,0,Pt),new Ht(4,4,8,4,jt),new Ht(4,5,16,8,jt),new Ht(4,6,32,32,jt),new Ht(4,4,16,16,Wt),new Ht(8,16,32,32,Wt),new Ht(8,16,128,128,Wt),new Ht(8,32,128,256,Wt),new Ht(32,128,258,1024,Wt),new Ht(32,258,258,4096,Wt)];function Yt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=At,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),$t(this.dyn_ltree),$t(this.dyn_dtree),$t(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),$t(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),$t(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const qt=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==zt&&57!==e.status&&69!==e.status&&73!==e.status&&91!==e.status&&103!==e.status&&e.status!==St&&e.status!==Lt?1:0},Qt=t=>{if(qt(t))return Ft(t,_t);t.total_in=t.total_out=0,t.data_type=vt;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=2===e.wrap?57:e.wrap?zt:St,t.adler=2===e.wrap?0:1,e.last_flush=-2,nt(e),ft},Gt=t=>{const e=Qt(t);var n;return e===ft&&((n=t.state).window_size=2*n.w_size,$t(n.head),n.max_lazy_match=Kt[n.level].max_lazy,n.good_match=Kt[n.level].good_length,n.nice_match=Kt[n.level].nice_length,n.max_chain_length=Kt[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),e},Xt=(t,e,n,r,s,a)=>{if(!t)return _t;let i=1;if(e===wt&&(e=6),r<0?(i=0,r=-r):r>15&&(i=2,r-=16),s<1||s>9||n!==At||r<8||r>15||e<0||e>9||a<0||a>yt||8===r&&1!==i)return Ft(t,_t);8===r&&(r=9);const o=new Yt;return t.state=o,o.strm=t,o.status=zt,o.wrap=i,o.gzhead=null,o.w_bits=r,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=s+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<s+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=e,o.strategy=a,o.method=n,Gt(t)};var Jt={deflateInit:(t,e)=>Xt(t,e,At,15,8,kt),deflateInit2:Xt,deflateReset:Gt,deflateResetKeep:Qt,deflateSetHeader:(t,e)=>qt(t)||2!==t.state.wrap?_t:(t.state.gzhead=e,ft),deflate:(t,e)=>{if(qt(t)||e>ct||e<0)return t?Ft(t,_t):_t;const n=t.state;if(!t.output||0!==t.avail_in&&!t.input||n.status===Lt&&e!==dt)return Ft(t,0===t.avail_out?pt:_t);const r=n.last_flush;if(n.last_flush=e,0!==n.pending){if(Dt(t),0===t.avail_out)return n.last_flush=-1,ft}else if(0===t.avail_in&&Mt(e)<=Mt(r)&&e!==dt)return Ft(t,pt);if(n.status===Lt&&0!==t.avail_in)return Ft(t,pt);if(n.status===zt&&0===n.wrap&&(n.status=St),n.status===zt){let e=At+(n.w_bits-8<<4)<<8,r=-1;if(r=n.strategy>=bt||n.level<2?0:n.level<6?1:6===n.level?2:3,e|=r<<6,0!==n.strstart&&(e|=32),e+=31-e%31,Zt(n,e),0!==n.strstart&&(Zt(n,t.adler>>>16),Zt(n,65535&t.adler)),t.adler=1,n.status=St,Dt(t),0!==n.pending)return n.last_flush=-1,ft}if(57===n.status)if(t.adler=0,Nt(n,31),Nt(n,139),Nt(n,8),n.gzhead)Nt(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Nt(n,255&n.gzhead.time),Nt(n,n.gzhead.time>>8&255),Nt(n,n.gzhead.time>>16&255),Nt(n,n.gzhead.time>>24&255),Nt(n,9===n.level?2:n.strategy>=bt||n.level<2?4:0),Nt(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Nt(n,255&n.gzhead.extra.length),Nt(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=V(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Nt(n,0),Nt(n,0),Nt(n,0),Nt(n,0),Nt(n,0),Nt(n,9===n.level?2:n.strategy>=bt||n.level<2?4:0),Nt(n,3),n.status=St,Dt(t),0!==n.pending)return n.last_flush=-1,ft;if(69===n.status){if(n.gzhead.extra){let e=n.pending,r=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+r>n.pending_buf_size;){let s=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>e&&(t.adler=V(t.adler,n.pending_buf,n.pending-e,e)),n.gzindex+=s,Dt(t),0!==n.pending)return n.last_flush=-1,ft;e=0,r-=s}let s=new Uint8Array(n.gzhead.extra);n.pending_buf.set(s.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending+=r,n.gzhead.hcrc&&n.pending>e&&(t.adler=V(t.adler,n.pending_buf,n.pending-e,e)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let e,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(t.adler=V(t.adler,n.pending_buf,n.pending-r,r)),Dt(t),0!==n.pending)return n.last_flush=-1,ft;r=0}e=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Nt(n,e)}while(0!==e);n.gzhead.hcrc&&n.pending>r&&(t.adler=V(t.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let e,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(t.adler=V(t.adler,n.pending_buf,n.pending-r,r)),Dt(t),0!==n.pending)return n.last_flush=-1,ft;r=0}e=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Nt(n,e)}while(0!==e);n.gzhead.hcrc&&n.pending>r&&(t.adler=V(t.adler,n.pending_buf,n.pending-r,r))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(Dt(t),0!==n.pending))return n.last_flush=-1,ft;Nt(n,255&t.adler),Nt(n,t.adler>>8&255),t.adler=0}if(n.status=St,Dt(t),0!==n.pending)return n.last_flush=-1,ft}if(0!==t.avail_in||0!==n.lookahead||e!==ot&&n.status!==Lt){let r=0===n.level?Pt(n,e):n.strategy===bt?((t,e)=>{let n;for(;;){if(0===t.lookahead&&(Ot(t),0===t.lookahead)){if(e===ot)return 1;break}if(t.match_length=0,n=at(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(Ut(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===dt?(Ut(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(Ut(t,!1),0===t.strm.avail_out)?1:2})(n,e):n.strategy===xt?((t,e)=>{let n,r,s,a;const i=t.window;for(;;){if(t.lookahead<=Tt){if(Ot(t),t.lookahead<=Tt&&e===ot)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(s=t.strstart-1,r=i[s],r===i[++s]&&r===i[++s]&&r===i[++s])){a=t.strstart+Tt;do{}while(r===i[++s]&&r===i[++s]&&r===i[++s]&&r===i[++s]&&r===i[++s]&&r===i[++s]&&r===i[++s]&&r===i[++s]&&s<a);t.match_length=Tt-(a-s),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(n=at(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=at(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(Ut(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===dt?(Ut(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(Ut(t,!1),0===t.strm.avail_out)?1:2})(n,e):Kt[n.level].func(n,e);if(3!==r&&4!==r||(n.status=Lt),1===r||3===r)return 0===t.avail_out&&(n.last_flush=-1),ft;if(2===r&&(e===lt?it(n):e!==ct&&(rt(n,0,0,!1),e===ht&&($t(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),Dt(t),0===t.avail_out))return n.last_flush=-1,ft}return e!==dt?ft:n.wrap<=0?ut:(2===n.wrap?(Nt(n,255&t.adler),Nt(n,t.adler>>8&255),Nt(n,t.adler>>16&255),Nt(n,t.adler>>24&255),Nt(n,255&t.total_in),Nt(n,t.total_in>>8&255),Nt(n,t.total_in>>16&255),Nt(n,t.total_in>>24&255)):(Zt(n,t.adler>>>16),Zt(n,65535&t.adler)),Dt(t),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?ft:ut)},deflateEnd:t=>{if(qt(t))return _t;const e=t.state.status;return t.state=null,e===St?Ft(t,gt):ft},deflateSetDictionary:(t,e)=>{let n=e.length;if(qt(t))return _t;const r=t.state,s=r.wrap;if(2===s||1===s&&r.status!==zt||r.lookahead)return _t;if(1===s&&(t.adler=X(t.adler,e,n,0)),r.wrap=0,n>=r.w_size){0===s&&($t(r.head),r.strstart=0,r.block_start=0,r.insert=0);let t=new Uint8Array(r.w_size);t.set(e.subarray(n-r.w_size,n),0),e=t,n=r.w_size}const a=t.avail_in,i=t.next_in,o=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,Ot(r);r.lookahead>=3;){let t=r.strstart,e=r.lookahead-2;do{r.ins_h=Rt(r,r.ins_h,r.window[t+3-1]),r.prev[t&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=t,t++}while(--e);r.strstart=t,r.lookahead=2,Ot(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,t.next_in=i,t.input=o,t.avail_in=a,r.wrap=s,ft},deflateInfo:"pako deflate (from Nodeca project)"};const Vt=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var te=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const e in n)Vt(n,e)&&(t[e]=n[e])}}return t},ee=t=>{let e=0;for(let n=0,r=t.length;n<r;n++)e+=t[n].length;const n=new Uint8Array(e);for(let e=0,r=0,s=t.length;e<s;e++){let s=t[e];n.set(s,r),r+=s.length}return n};let ne=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){ne=!1}const re=new Uint8Array(256);for(let t=0;t<256;t++)re[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;re[254]=re[254]=1;var se=t=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,n,r,s,a,i=t.length,o=0;for(s=0;s<i;s++)n=t.charCodeAt(s),55296==(64512&n)&&s+1<i&&(r=t.charCodeAt(s+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),s++)),o+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(o),a=0,s=0;a<o;s++)n=t.charCodeAt(s),55296==(64512&n)&&s+1<i&&(r=t.charCodeAt(s+1),56320==(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),s++)),n<128?e[a++]=n:n<2048?(e[a++]=192|n>>>6,e[a++]=128|63&n):n<65536?(e[a++]=224|n>>>12,e[a++]=128|n>>>6&63,e[a++]=128|63&n):(e[a++]=240|n>>>18,e[a++]=128|n>>>12&63,e[a++]=128|n>>>6&63,e[a++]=128|63&n);return e},ae=(t,e)=>{const n=e||t.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,e));let r,s;const a=new Array(2*n);for(s=0,r=0;r<n;){let e=t[r++];if(e<128){a[s++]=e;continue}let i=re[e];if(i>4)a[s++]=65533,r+=i-1;else{for(e&=2===i?31:3===i?15:7;i>1&&r<n;)e=e<<6|63&t[r++],i--;i>1?a[s++]=65533:e<65536?a[s++]=e:(e-=65536,a[s++]=55296|e>>10&1023,a[s++]=56320|1023&e)}}return((t,e)=>{if(e<65534&&t.subarray&&ne)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(t[r]);return n})(a,s)},ie=(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let n=e-1;for(;n>=0&&128==(192&t[n]);)n--;return n<0||0===n?e:n+re[t[n]]>e?n:e};var oe=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const le=Object.prototype.toString,{Z_NO_FLUSH:he,Z_SYNC_FLUSH:de,Z_FULL_FLUSH:ce,Z_FINISH:fe,Z_OK:ue,Z_STREAM_END:_e,Z_DEFAULT_COMPRESSION:ge,Z_DEFAULT_STRATEGY:pe,Z_DEFLATED:we}=et;function me(t){this.options=te({level:ge,method:we,chunkSize:16384,windowBits:15,memLevel:8,strategy:pe},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new oe,this.strm.avail_out=0;let n=Jt.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==ue)throw new Error(tt[n]);if(e.header&&Jt.deflateSetHeader(this.strm,e.header),e.dictionary){let t;if(t="string"==typeof e.dictionary?se(e.dictionary):"[object ArrayBuffer]"===le.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,n=Jt.deflateSetDictionary(this.strm,t),n!==ue)throw new Error(tt[n]);this._dict_set=!0}}function be(t,e){const n=new me(e);if(n.push(t,!0),n.err)throw n.msg||tt[n.err];return n.result}me.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize;let s,a;if(this.ended)return!1;for(a=e===~~e?e:!0===e?fe:he,"string"==typeof t?n.input=se(t):"[object ArrayBuffer]"===le.call(t)?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(a===de||a===ce)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(s=Jt.deflate(n,a),s===_e)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),s=Jt.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===ue;if(0!==n.avail_out){if(a>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},me.prototype.onData=function(t){this.chunks.push(t)},me.prototype.onEnd=function(t){t===ue&&(this.result=ee(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var xe={Deflate:me,deflate:be,deflateRaw:function(t,e){return(e=e||{}).raw=!0,be(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,be(t,e)},constants:et};const ye=16209;var ke=function(t,e){let n,r,s,a,i,o,l,h,d,c,f,u,_,g,p,w,m,b,x,y,k,v,A,T;const E=t.state;n=t.next_in,A=t.input,r=n+(t.avail_in-5),s=t.next_out,T=t.output,a=s-(e-t.avail_out),i=s+(t.avail_out-257),o=E.dmax,l=E.wsize,h=E.whave,d=E.wnext,c=E.window,f=E.hold,u=E.bits,_=E.lencode,g=E.distcode,p=(1<<E.lenbits)-1,w=(1<<E.distbits)-1;t:do{u<15&&(f+=A[n++]<<u,u+=8,f+=A[n++]<<u,u+=8),m=_[f&p];e:for(;;){if(b=m>>>24,f>>>=b,u-=b,b=m>>>16&255,0===b)T[s++]=65535&m;else{if(!(16&b)){if(64&b){if(32&b){E.mode=16191;break t}t.msg="invalid literal/length code",E.mode=ye;break t}m=_[(65535&m)+(f&(1<<b)-1)];continue e}for(x=65535&m,b&=15,b&&(u<b&&(f+=A[n++]<<u,u+=8),x+=f&(1<<b)-1,f>>>=b,u-=b),u<15&&(f+=A[n++]<<u,u+=8,f+=A[n++]<<u,u+=8),m=g[f&w];;){if(b=m>>>24,f>>>=b,u-=b,b=m>>>16&255,16&b){if(y=65535&m,b&=15,u<b&&(f+=A[n++]<<u,u+=8,u<b&&(f+=A[n++]<<u,u+=8)),y+=f&(1<<b)-1,y>o){t.msg="invalid distance too far back",E.mode=ye;break t}if(f>>>=b,u-=b,b=s-a,y>b){if(b=y-b,b>h&&E.sane){t.msg="invalid distance too far back",E.mode=ye;break t}if(k=0,v=c,0===d){if(k+=l-b,b<x){x-=b;do{T[s++]=c[k++]}while(--b);k=s-y,v=T}}else if(d<b){if(k+=l+d-b,b-=d,b<x){x-=b;do{T[s++]=c[k++]}while(--b);if(k=0,d<x){b=d,x-=b;do{T[s++]=c[k++]}while(--b);k=s-y,v=T}}}else if(k+=d-b,b<x){x-=b;do{T[s++]=c[k++]}while(--b);k=s-y,v=T}for(;x>2;)T[s++]=v[k++],T[s++]=v[k++],T[s++]=v[k++],x-=3;x&&(T[s++]=v[k++],x>1&&(T[s++]=v[k++]))}else{k=s-y;do{T[s++]=T[k++],T[s++]=T[k++],T[s++]=T[k++],x-=3}while(x>2);x&&(T[s++]=T[k++],x>1&&(T[s++]=T[k++]))}break}if(64&b){t.msg="invalid distance code",E.mode=ye;break t}m=g[(65535&m)+(f&(1<<b)-1)]}}break}}while(n<r&&s<i);x=u>>3,n-=x,u-=x<<3,f&=(1<<u)-1,t.next_in=n,t.next_out=s,t.avail_in=n<r?r-n+5:5-(n-r),t.avail_out=s<i?i-s+257:257-(s-i),E.hold=f,E.bits=u};const ve=15,Ae=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Te=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Ee=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),ze=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Se=(t,e,n,r,s,a,i,o)=>{const l=o.bits;let h,d,c,f,u,_,g=0,p=0,w=0,m=0,b=0,x=0,y=0,k=0,v=0,A=0,T=null;const E=new Uint16Array(16),z=new Uint16Array(16);let S,L,F,M=null;for(g=0;g<=ve;g++)E[g]=0;for(p=0;p<r;p++)E[e[n+p]]++;for(b=l,m=ve;m>=1&&0===E[m];m--);if(b>m&&(b=m),0===m)return s[a++]=20971520,s[a++]=20971520,o.bits=1,0;for(w=1;w<m&&0===E[w];w++);for(b<w&&(b=w),k=1,g=1;g<=ve;g++)if(k<<=1,k-=E[g],k<0)return-1;if(k>0&&(0===t||1!==m))return-1;for(z[1]=0,g=1;g<ve;g++)z[g+1]=z[g]+E[g];for(p=0;p<r;p++)0!==e[n+p]&&(i[z[e[n+p]]++]=p);if(0===t?(T=M=i,_=20):1===t?(T=Ae,M=Te,_=257):(T=Ee,M=ze,_=0),A=0,p=0,g=w,u=a,x=b,y=0,c=-1,v=1<<b,f=v-1,1===t&&v>852||2===t&&v>592)return 1;for(;;){S=g-y,i[p]+1<_?(L=0,F=i[p]):i[p]>=_?(L=M[i[p]-_],F=T[i[p]-_]):(L=96,F=0),h=1<<g-y,d=1<<x,w=d;do{d-=h,s[u+(A>>y)+d]=S<<24|L<<16|F}while(0!==d);for(h=1<<g-1;A&h;)h>>=1;if(0!==h?(A&=h-1,A+=h):A=0,p++,0===--E[g]){if(g===m)break;g=e[n+i[p]]}if(g>b&&(A&f)!==c){for(0===y&&(y=b),u+=w,x=g-y,k=1<<x;x+y<m&&(k-=E[x+y],!(k<=0));)x++,k<<=1;if(v+=1<<x,1===t&&v>852||2===t&&v>592)return 1;c=A&f,s[c]=b<<24|x<<16|u-a}}return 0!==A&&(s[u+A]=g-y<<24|64<<16),o.bits=b,0};const{Z_FINISH:Le,Z_BLOCK:Fe,Z_TREES:Me,Z_OK:$e,Z_STREAM_END:Ie,Z_NEED_DICT:Re,Z_STREAM_ERROR:De,Z_DATA_ERROR:Ue,Z_MEM_ERROR:Ne,Z_BUF_ERROR:Ze,Z_DEFLATED:Ce}=et,Be=16180,Oe=16190,Pe=16191,je=16192,We=16194,He=16199,Ke=16200,Ye=16206,qe=16209,Qe=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function Ge(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Xe=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<Be||e.mode>16211?1:0},Je=t=>{if(Xe(t))return De;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=Be,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,$e},Ve=t=>{if(Xe(t))return De;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,Je(t)},tn=(t,e)=>{let n;if(Xe(t))return De;const r=t.state;return e<0?(n=0,e=-e):(n=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?De:(null!==r.window&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,Ve(t))},en=(t,e)=>{if(!t)return De;const n=new Ge;t.state=n,n.strm=t,n.window=null,n.mode=Be;const r=tn(t,e);return r!==$e&&(t.state=null),r};let nn,rn,sn=!0;const an=t=>{if(sn){nn=new Int32Array(512),rn=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(Se(1,t.lens,0,288,nn,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;Se(2,t.lens,0,32,rn,0,t.work,{bits:5}),sn=!1}t.lencode=nn,t.lenbits=9,t.distcode=rn,t.distbits=5},on=(t,e,n,r)=>{let s;const a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new Uint8Array(a.wsize)),r>=a.wsize?(a.window.set(e.subarray(n-a.wsize,n),0),a.wnext=0,a.whave=a.wsize):(s=a.wsize-a.wnext,s>r&&(s=r),a.window.set(e.subarray(n-r,n-r+s),a.wnext),(r-=s)?(a.window.set(e.subarray(n-r,n),0),a.wnext=r,a.whave=a.wsize):(a.wnext+=s,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=s))),0};var ln={inflateReset:Ve,inflateReset2:tn,inflateResetKeep:Je,inflateInit:t=>en(t,15),inflateInit2:en,inflate:(t,e)=>{let n,r,s,a,i,o,l,h,d,c,f,u,_,g,p,w,m,b,x,y,k,v,A=0;const T=new Uint8Array(4);let E,z;const S=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Xe(t)||!t.output||!t.input&&0!==t.avail_in)return De;n=t.state,n.mode===Pe&&(n.mode=je),i=t.next_out,s=t.output,l=t.avail_out,a=t.next_in,r=t.input,o=t.avail_in,h=n.hold,d=n.bits,c=o,f=l,v=$e;t:for(;;)switch(n.mode){case Be:if(0===n.wrap){n.mode=je;break}for(;d<16;){if(0===o)break t;o--,h+=r[a++]<<d,d+=8}if(2&n.wrap&&35615===h){0===n.wbits&&(n.wbits=15),n.check=0,T[0]=255&h,T[1]=h>>>8&255,n.check=V(n.check,T,2,0),h=0,d=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&h)<<8)+(h>>8))%31){t.msg="incorrect header check",n.mode=qe;break}if((15&h)!==Ce){t.msg="unknown compression method",n.mode=qe;break}if(h>>>=4,d-=4,k=8+(15&h),0===n.wbits&&(n.wbits=k),k>15||k>n.wbits){t.msg="invalid window size",n.mode=qe;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=512&h?16189:Pe,h=0,d=0;break;case 16181:for(;d<16;){if(0===o)break t;o--,h+=r[a++]<<d,d+=8}if(n.flags=h,(255&n.flags)!==Ce){t.msg="unknown compression method",n.mode=qe;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=qe;break}n.head&&(n.head.text=h>>8&1),512&n.flags&&4&n.wrap&&(T[0]=255&h,T[1]=h>>>8&255,n.check=V(n.check,T,2,0)),h=0,d=0,n.mode=16182;case 16182:for(;d<32;){if(0===o)break t;o--,h+=r[a++]<<d,d+=8}n.head&&(n.head.time=h),512&n.flags&&4&n.wrap&&(T[0]=255&h,T[1]=h>>>8&255,T[2]=h>>>16&255,T[3]=h>>>24&255,n.check=V(n.check,T,4,0)),h=0,d=0,n.mode=16183;case 16183:for(;d<16;){if(0===o)break t;o--,h+=r[a++]<<d,d+=8}n.head&&(n.head.xflags=255&h,n.head.os=h>>8),512&n.flags&&4&n.wrap&&(T[0]=255&h,T[1]=h>>>8&255,n.check=V(n.check,T,2,0)),h=0,d=0,n.mode=16184;case 16184:if(1024&n.flags){for(;d<16;){if(0===o)break t;o--,h+=r[a++]<<d,d+=8}n.length=h,n.head&&(n.head.extra_len=h),512&n.flags&&4&n.wrap&&(T[0]=255&h,T[1]=h>>>8&255,n.check=V(n.check,T,2,0)),h=0,d=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&(u=n.length,u>o&&(u=o),u&&(n.head&&(k=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(a,a+u),k)),512&n.flags&&4&n.wrap&&(n.check=V(n.check,r,u,a)),o-=u,a+=u,n.length-=u),n.length))break t;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===o)break t;u=0;do{k=r[a+u++],n.head&&k&&n.length<65536&&(n.head.name+=String.fromCharCode(k))}while(k&&u<o);if(512&n.flags&&4&n.wrap&&(n.check=V(n.check,r,u,a)),o-=u,a+=u,k)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===o)break t;u=0;do{k=r[a+u++],n.head&&k&&n.length<65536&&(n.head.comment+=String.fromCharCode(k))}while(k&&u<o);if(512&n.flags&&4&n.wrap&&(n.check=V(n.check,r,u,a)),o-=u,a+=u,k)break t}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;d<16;){if(0===o)break t;o--,h+=r[a++]<<d,d+=8}if(4&n.wrap&&h!==(65535&n.check)){t.msg="header crc mismatch",n.mode=qe;break}h=0,d=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=Pe;break;case 16189:for(;d<32;){if(0===o)break t;o--,h+=r[a++]<<d,d+=8}t.adler=n.check=Qe(h),h=0,d=0,n.mode=Oe;case Oe:if(0===n.havedict)return t.next_out=i,t.avail_out=l,t.next_in=a,t.avail_in=o,n.hold=h,n.bits=d,Re;t.adler=n.check=1,n.mode=Pe;case Pe:if(e===Fe||e===Me)break t;case je:if(n.last){h>>>=7&d,d-=7&d,n.mode=Ye;break}for(;d<3;){if(0===o)break t;o--,h+=r[a++]<<d,d+=8}switch(n.last=1&h,h>>>=1,d-=1,3&h){case 0:n.mode=16193;break;case 1:if(an(n),n.mode=He,e===Me){h>>>=2,d-=2;break t}break;case 2:n.mode=16196;break;case 3:t.msg="invalid block type",n.mode=qe}h>>>=2,d-=2;break;case 16193:for(h>>>=7&d,d-=7&d;d<32;){if(0===o)break t;o--,h+=r[a++]<<d,d+=8}if((65535&h)!=(h>>>16^65535)){t.msg="invalid stored block lengths",n.mode=qe;break}if(n.length=65535&h,h=0,d=0,n.mode=We,e===Me)break t;case We:n.mode=16195;case 16195:if(u=n.length,u){if(u>o&&(u=o),u>l&&(u=l),0===u)break t;s.set(r.subarray(a,a+u),i),o-=u,a+=u,l-=u,i+=u,n.length-=u;break}n.mode=Pe;break;case 16196:for(;d<14;){if(0===o)break t;o--,h+=r[a++]<<d,d+=8}if(n.nlen=257+(31&h),h>>>=5,d-=5,n.ndist=1+(31&h),h>>>=5,d-=5,n.ncode=4+(15&h),h>>>=4,d-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=qe;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;d<3;){if(0===o)break t;o--,h+=r[a++]<<d,d+=8}n.lens[S[n.have++]]=7&h,h>>>=3,d-=3}for(;n.have<19;)n.lens[S[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,E={bits:n.lenbits},v=Se(0,n.lens,0,19,n.lencode,0,n.work,E),n.lenbits=E.bits,v){t.msg="invalid code lengths set",n.mode=qe;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;A=n.lencode[h&(1<<n.lenbits)-1],p=A>>>24,w=A>>>16&255,m=65535&A,!(p<=d);){if(0===o)break t;o--,h+=r[a++]<<d,d+=8}if(m<16)h>>>=p,d-=p,n.lens[n.have++]=m;else{if(16===m){for(z=p+2;d<z;){if(0===o)break t;o--,h+=r[a++]<<d,d+=8}if(h>>>=p,d-=p,0===n.have){t.msg="invalid bit length repeat",n.mode=qe;break}k=n.lens[n.have-1],u=3+(3&h),h>>>=2,d-=2}else if(17===m){for(z=p+3;d<z;){if(0===o)break t;o--,h+=r[a++]<<d,d+=8}h>>>=p,d-=p,k=0,u=3+(7&h),h>>>=3,d-=3}else{for(z=p+7;d<z;){if(0===o)break t;o--,h+=r[a++]<<d,d+=8}h>>>=p,d-=p,k=0,u=11+(127&h),h>>>=7,d-=7}if(n.have+u>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=qe;break}for(;u--;)n.lens[n.have++]=k}}if(n.mode===qe)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=qe;break}if(n.lenbits=9,E={bits:n.lenbits},v=Se(1,n.lens,0,n.nlen,n.lencode,0,n.work,E),n.lenbits=E.bits,v){t.msg="invalid literal/lengths set",n.mode=qe;break}if(n.distbits=6,n.distcode=n.distdyn,E={bits:n.distbits},v=Se(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,E),n.distbits=E.bits,v){t.msg="invalid distances set",n.mode=qe;break}if(n.mode=He,e===Me)break t;case He:n.mode=Ke;case Ke:if(o>=6&&l>=258){t.next_out=i,t.avail_out=l,t.next_in=a,t.avail_in=o,n.hold=h,n.bits=d,ke(t,f),i=t.next_out,s=t.output,l=t.avail_out,a=t.next_in,r=t.input,o=t.avail_in,h=n.hold,d=n.bits,n.mode===Pe&&(n.back=-1);break}for(n.back=0;A=n.lencode[h&(1<<n.lenbits)-1],p=A>>>24,w=A>>>16&255,m=65535&A,!(p<=d);){if(0===o)break t;o--,h+=r[a++]<<d,d+=8}if(w&&!(240&w)){for(b=p,x=w,y=m;A=n.lencode[y+((h&(1<<b+x)-1)>>b)],p=A>>>24,w=A>>>16&255,m=65535&A,!(b+p<=d);){if(0===o)break t;o--,h+=r[a++]<<d,d+=8}h>>>=b,d-=b,n.back+=b}if(h>>>=p,d-=p,n.back+=p,n.length=m,0===w){n.mode=16205;break}if(32&w){n.back=-1,n.mode=Pe;break}if(64&w){t.msg="invalid literal/length code",n.mode=qe;break}n.extra=15&w,n.mode=16201;case 16201:if(n.extra){for(z=n.extra;d<z;){if(0===o)break t;o--,h+=r[a++]<<d,d+=8}n.length+=h&(1<<n.extra)-1,h>>>=n.extra,d-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;A=n.distcode[h&(1<<n.distbits)-1],p=A>>>24,w=A>>>16&255,m=65535&A,!(p<=d);){if(0===o)break t;o--,h+=r[a++]<<d,d+=8}if(!(240&w)){for(b=p,x=w,y=m;A=n.distcode[y+((h&(1<<b+x)-1)>>b)],p=A>>>24,w=A>>>16&255,m=65535&A,!(b+p<=d);){if(0===o)break t;o--,h+=r[a++]<<d,d+=8}h>>>=b,d-=b,n.back+=b}if(h>>>=p,d-=p,n.back+=p,64&w){t.msg="invalid distance code",n.mode=qe;break}n.offset=m,n.extra=15&w,n.mode=16203;case 16203:if(n.extra){for(z=n.extra;d<z;){if(0===o)break t;o--,h+=r[a++]<<d,d+=8}n.offset+=h&(1<<n.extra)-1,h>>>=n.extra,d-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=qe;break}n.mode=16204;case 16204:if(0===l)break t;if(u=f-l,n.offset>u){if(u=n.offset-u,u>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=qe;break}u>n.wnext?(u-=n.wnext,_=n.wsize-u):_=n.wnext-u,u>n.length&&(u=n.length),g=n.window}else g=s,_=i-n.offset,u=n.length;u>l&&(u=l),l-=u,n.length-=u;do{s[i++]=g[_++]}while(--u);0===n.length&&(n.mode=Ke);break;case 16205:if(0===l)break t;s[i++]=n.length,l--,n.mode=Ke;break;case Ye:if(n.wrap){for(;d<32;){if(0===o)break t;o--,h|=r[a++]<<d,d+=8}if(f-=l,t.total_out+=f,n.total+=f,4&n.wrap&&f&&(t.adler=n.check=n.flags?V(n.check,s,f,i-f):X(n.check,s,f,i-f)),f=l,4&n.wrap&&(n.flags?h:Qe(h))!==n.check){t.msg="incorrect data check",n.mode=qe;break}h=0,d=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;d<32;){if(0===o)break t;o--,h+=r[a++]<<d,d+=8}if(4&n.wrap&&h!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=qe;break}h=0,d=0}n.mode=16208;case 16208:v=Ie;break t;case qe:v=Ue;break t;case 16210:return Ne;default:return De}return t.next_out=i,t.avail_out=l,t.next_in=a,t.avail_in=o,n.hold=h,n.bits=d,(n.wsize||f!==t.avail_out&&n.mode<qe&&(n.mode<Ye||e!==Le))&&on(t,t.output,t.next_out,f-t.avail_out),c-=t.avail_in,f-=t.avail_out,t.total_in+=c,t.total_out+=f,n.total+=f,4&n.wrap&&f&&(t.adler=n.check=n.flags?V(n.check,s,f,t.next_out-f):X(n.check,s,f,t.next_out-f)),t.data_type=n.bits+(n.last?64:0)+(n.mode===Pe?128:0)+(n.mode===He||n.mode===We?256:0),(0===c&&0===f||e===Le)&&v===$e&&(v=Ze),v},inflateEnd:t=>{if(Xe(t))return De;let e=t.state;return e.window&&(e.window=null),t.state=null,$e},inflateGetHeader:(t,e)=>{if(Xe(t))return De;const n=t.state;return 2&n.wrap?(n.head=e,e.done=!1,$e):De},inflateSetDictionary:(t,e)=>{const n=e.length;let r,s,a;return Xe(t)?De:(r=t.state,0!==r.wrap&&r.mode!==Oe?De:r.mode===Oe&&(s=1,s=X(s,e,n,0),s!==r.check)?Ue:(a=on(t,e,n,n),a?(r.mode=16210,Ne):(r.havedict=1,$e)))},inflateInfo:"pako inflate (from Nodeca project)"};var hn=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const dn=Object.prototype.toString,{Z_NO_FLUSH:cn,Z_FINISH:fn,Z_OK:un,Z_STREAM_END:_n,Z_NEED_DICT:gn,Z_STREAM_ERROR:pn,Z_DATA_ERROR:wn,Z_MEM_ERROR:mn}=et;function bn(t){this.options=te({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(15&e.windowBits||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new oe,this.strm.avail_out=0;let n=ln.inflateInit2(this.strm,e.windowBits);if(n!==un)throw new Error(tt[n]);if(this.header=new hn,ln.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=se(e.dictionary):"[object ArrayBuffer]"===dn.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=ln.inflateSetDictionary(this.strm,e.dictionary),n!==un)))throw new Error(tt[n])}function xn(t,e){const n=new bn(e);if(n.push(t),n.err)throw n.msg||tt[n.err];return n.result}bn.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize,s=this.options.dictionary;let a,i,o;if(this.ended)return!1;for(i=e===~~e?e:!0===e?fn:cn,"[object ArrayBuffer]"===dn.call(t)?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),a=ln.inflate(n,i),a===gn&&s&&(a=ln.inflateSetDictionary(n,s),a===un?a=ln.inflate(n,i):a===wn&&(a=gn));n.avail_in>0&&a===_n&&n.state.wrap>0&&0!==t[n.next_in];)ln.inflateReset(n),a=ln.inflate(n,i);switch(a){case pn:case wn:case gn:case mn:return this.onEnd(a),this.ended=!0,!1}if(o=n.avail_out,n.next_out&&(0===n.avail_out||a===_n))if("string"===this.options.to){let t=ie(n.output,n.next_out),e=n.next_out-t,s=ae(n.output,t);n.next_out=e,n.avail_out=r-e,e&&n.output.set(n.output.subarray(t,t+e),0),this.onData(s)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(a!==un||0!==o){if(a===_n)return a=ln.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},bn.prototype.onData=function(t){this.chunks.push(t)},bn.prototype.onEnd=function(t){t===un&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=ee(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var yn={Inflate:bn,inflate:xn,inflateRaw:function(t,e){return(e=e||{}).raw=!0,xn(t,e)},ungzip:xn,constants:et};const{Deflate:kn,deflate:vn,deflateRaw:An,gzip:Tn}=xe,{Inflate:En,inflate:zn,inflateRaw:Sn,ungzip:Ln}=yn;var Fn=vn,Mn=zn,$n=Sn;const In="krc1",Rn=[64,71,97,119,94,50,116,71,81,54,49,45,206,210,110,105];function Dn(t,e=Rn){const n=new Uint8Array(t.length),r=e.length;for(let s=0;s<t.length;s++)n[s]=t[s]^255&e[s%r];return n}const Un=/\[([a-z#]+):([^\]]*)\]/i,Nn=/\[(\d+),(\d+)\]/,Zn=/<(\d+),(\d+),0>([^<]+)/;class Cn{static parse(t,e){const n=this.#_(new Uint8Array(e));let r={lrc:""};n.split(/\r?\n/).forEach(e=>this.#t(t,e,r)),h.parse(t,r.lrc)}static#_(t){if(t.byteLength<4)throw new RangeError;const e=(new TextDecoder).decode(t.slice(0,4));if(In!==e)throw new TypeError;const n=Dn(t.slice(4),Rn),r=Mn(n,{to:"string"});return 65279===(s=r).charCodeAt(0)?s.slice(1):s;var s}static#t(t,e,n){Un.test(e)?this.#g(t,e,n):Nn.test(e)&&this.#s(t,e,n)}static#g(t,e,n){const r=Un.exec(e);if(!r)return;if("language"===r[1].toLowerCase())try{const e=function(t){const e=globalThis;return"function"==typeof e?.atob?e.atob(t):"undefined"!=typeof Buffer?Buffer.from(t,"base64").toString("utf-8"):t}(r[2]);t.metadata.set("language",JSON.parse(e))}catch{}else n.lrc+=e+"\n"}static#s(t,e,n){let r,s="",a=e;for(;r=Nn.exec(a);)s+=`[${new f(parseInt(r[1])).format("mm:ss:S")}]`,a=a.replace(r[0],"");for(;r=Zn.exec(a);)s+=`<${r[2]}>${r[3]}`,a=a.replace(r[0],"");n.lrc+=s+"\n"}}class Bn{static generate(t){if(!(t instanceof gr))throw new TypeError("参数 1 必须为 Lyric 实例");const e=[];t.metadata.forEach((t,n)=>{if("language"===n.toLowerCase())try{let n=t;if("string"==typeof t)try{n=JSON.parse(t)}catch{n=t}const r=function(t){const e=globalThis;return"function"==typeof e?.btoa?e.btoa(t):"undefined"!=typeof Buffer?Buffer.from(t,"utf-8").toString("base64"):t}(JSON.stringify(n));e.push(`[language:${r}]`)}catch{e.push(`[language:${String(t)}]`)}else e.push(`[${n}:${String(t)}]`)});for(const n of t.lines){const t=!0===n.pseudoPerWord,r=Math.max(0,Math.round(n.startTime||0));let s=Math.round(n.duration||0);(!Number.isFinite(s)||s<0)&&(s=0);const a=n.rowTexts&&n.rowTexts.length>0?n.rowTexts:n.text?n.text.split("\n"):[""],i=t=>(t||"").replace(/[\s\u200b]+/g,""),o=a.map(t=>i(t)),l=(n.words||[]).filter(t=>!t.singleLine),h=i(l.map(t=>t.text||"").join(""));let d=-1;h&&(d=o.findIndex(t=>t===h));for(let h=0;h<a.length;h++){const c=h+1;let f=t?[]:(n.words||[]).filter(t=>!t.singleLine&&(t?.lineNo||0)===c),u=a[h]||"";u.includes("\n")&&(u=u.split("\n")[0]||"");const _=i(u);for(let t=0;t<a.length;t++){if(t===h)continue;const e=a[t]||"",n=i(e);if(n&&_.endsWith(n)){const t=_.lastIndexOf(n);u=u.slice(0,Math.max(0,u.length-(_.length-t)));break}}if(f.length>0){const t=i(f.map(t=>t.text||"").join(""));if(!(t&&t===o[h])&&t&&o.length>1){-1!==o.findIndex((e,n)=>n!==h&&e===t)&&(f=[])}}if(0===f.length&&d===h&&l.length>0&&(f=l),!t&&f.length>0){let t=0;const e=[],n=i(u);let r="";for(const s of f){const a=Math.max(0,Math.round(s.duration||0)),o=s.text&&s.text.length>0?s.text:"​",l=r+i(o);if(n&&l.length>n.length)break;if(n&&!n.startsWith(l))break;if(e.push(`<${t},${a},0>${o}`),t+=a,r=l,n&&r.length===n.length)break}u=e.length>0?e.join(""):`<0,${s},0>${u&&u.length>0?u:"​"}`}else{u=`<0,${s},0>${u&&u.length>0?u:"​"}`}e.push(`[${r},${s}]${u}`)}}const n=e.join("\n"),r=Dn(Fn(n),Rn),s=(new TextEncoder).encode(In),a=new Uint8Array(s.length+r.length);return a.set(s,0),a.set(r,s.length),a.buffer}}function On(t){const e=(t||"").trim(),n=/^(\d{1,2}):(\d{1,2})(?:[.:](\d{1,3}))?$/.exec(e);if(!n)return NaN;return 6e4*(parseInt(n[1],10)||0)+1e3*(parseInt(n[2],10)||0)+(n[3]?parseInt(n[3].padEnd(3,"0"),10):0)}function Pn(t){return(t||"").split(/\s*,\s*/).filter(Boolean).map(t=>{const e=parseInt(t,10);return Number.isFinite(e)&&e>0?e:0})}function jn(t){return Array.from(t||"")}class Wn{static parse(t,e){let n="";if(e instanceof ArrayBuffer){const t=e,r=(e,n=!1)=>{try{return new TextDecoder(e,{fatal:n}).decode(t)}catch{return null}};let s=r("utf-8",!0);if(null==s)s=r("gb18030")||r("gbk")||r("gb2312")||r("utf-8",!1);else{const t=(s.match(/\uFFFD/g)||[]).length;if(t>0){const e=r("gb18030");e&&(e.match(/\uFFFD/g)||[]).length<t&&(s=e)}}n=s??""}else n=e;if(n=function(t){return t&&65279===t.charCodeAt(0)?t.slice(1):t}(n||""),!/karaoke\s*\./i.test(n))throw new TypeError("非 KSC 内容");const r=n.split(/\r?\n/).map(t=>t.replace(/\/\/.*$/,"").trim()).filter(t=>t.length>0),s=/^karaoke\.tag\(\s*'([^']*)'\s*,\s*'([^']*)'\s*\)\s*;?$/i,a=/^karaoke\.rows\s*:=\s*(\d+)\s*;?$/i,i=/^karaoke\.(videofilename|audiofilename)\s*:=\s*'([^']*)'\s*;?$/i,o=/^karaoke\.(internalnumber)\s*:=\s*(\d+)\s*;?$/i,l=/^karaoke\.add\(\s*'([^']+)'\s*,\s*'([^']+)'\s*,\s*'([^']*)'\s*,\s*'([^']*)'\s*\)\s*;?$/i;let d,c="";for(const e of r){let n;if(n=s.exec(e)){const e=(n[1]||"").trim(),r=(n[2]||"").trim();"歌名"===e?t.metadata.set("ti",r):"歌手"===e&&t.metadata.set("ar",r),t.metadata.set(e,r),"歌名"===e&&(c+=`[ti:${r}]\n`),"歌手"===e&&(c+=`[ar:${r}]\n`);continue}if(n=a.exec(e))d=parseInt(n[1],10),Number.isFinite(d)&&t.metadata.set("rows",d);else{if(n=i.exec(e)){const e=n[1].toLowerCase(),r=n[2];t.metadata.set(e,r);continue}if(n=o.exec(e)){const e=n[1].toLowerCase(),r=parseInt(n[2],10);t.metadata.set(e,Number.isFinite(r)?r:n[2]);continue}if(n=l.exec(e)){const t=On(n[1]),e=On(n[2]);if(!Number.isFinite(t)||!Number.isFinite(e)||e<t)continue;const r=n[3]||"",s=Pn(n[4]||""),a=jn(r),i=(()=>{const e=Math.floor(t/1e3),n=Math.floor(e/60),r=e%60,s=t%1e3;return`[${String(n).padStart(2,"0")}:${String(r).padStart(2,"0")}.${String(s).padStart(3,"0")}]`})();let o="";if(s.length===a.length&&a.length>0)for(let t=0;t<a.length;t++){o+=`<${Math.max(0,Math.round(s[t]||0))}>${a[t]}`}else{o=`<${Math.max(0,Math.round(e-t))}>${r&&r.length>0?r:"​"}`}c+=`${i}${o}\n`;continue}}}h.parse(t,c)}}class Hn{static generate(t){if(!(t instanceof gr))throw new TypeError("参数 1 必须为 Lyric 实例");const e=t=>{const e=Math.max(0,Math.floor(t)),n=Math.floor(e/6e4),r=Math.floor(e%6e4/1e3),s=e%1e3;return`${String(n).padStart(2,"0")}:${String(r).padStart(2,"0")}.${String(s).padStart(3,"0")}`},n=t=>(t||"").replace(/\\/g,"\\\\").replace(/'/g,"\\'"),r=t=>(t||"").replace(/[\s\u200b]+/g,""),s=[];s.push("karaoke := CreateKaraokeObject;");let a=1;for(const e of t.lines){const t=e.rowTexts&&e.rowTexts.length>0?e.rowTexts:e.text?e.text.split("\n"):[""];t.length>a&&(a=t.length)}s.push(`karaoke.rows := ${Math.max(1,Math.min(a,4))};`),s.push("karaoke.clear;");const i=t.metadata,o=new Set,l=(t,e)=>{s.push(`karaoke.tag('${n(t)}', '${n(e)}');`),o.add(t)},h=(t,e)=>s.push(`karaoke.${t} := '${n(e)}';`),d=i.get("ti");"string"==typeof d&&d&&l("歌名",String(d));const c=i.get("ar");"string"==typeof c&&c&&l("歌手",String(c));const f=i.get("videofilename");"string"==typeof f&&f&&h("videofilename",f);const u=i.get("audiofilename");"string"==typeof u&&u&&h("audiofilename",u);const _=i.get("internalnumber");var g,p;"number"==typeof _&&(g="internalnumber",p=_,s.push(`karaoke.${g} := ${Math.trunc(p)};`)),i.forEach((t,e)=>{"ti"!==e&&"ar"!==e&&"rows"!==e&&"videofilename"!==e&&"audiofilename"!==e&&"internalnumber"!==e&&(o.has(e)||"string"!=typeof t&&"number"!=typeof t||l(e,String(t)))});for(const a of t.lines){const t=!0===a.pseudoPerWord,i=Math.max(0,Math.round(a.startTime||0));let o=Math.round(a.duration||0);(!Number.isFinite(o)||o<0)&&(o=0);const l=i+o,h=(a.words||[]).filter(t=>!t.singleLine),d=r(h.map(t=>t.text||"").join("")),c=a.rowTexts&&a.rowTexts.length>0?a.rowTexts:a.text?a.text.split("\n"):[""];for(let f=0;f<c.length;f++){const u=f+1;let _=c[f]||"";if(!_||!_.trim())continue;let g=t?[]:(a.words||[]).filter(t=>!t.singleLine&&(t?.lineNo||0)===u);const p=r(_);if(g.length>0){const t=r(g.map(t=>t.text||"").join(""));if(t&&p&&t!==p){-1!==c.findIndex((e,n)=>n!==f&&r(e)===t)&&(g=[])}}0===g.length&&h.length>0&&d&&d===p&&(g=h);const w=Array.from(_);let m="";const b=(t,e)=>{const n=Math.max(1,e),r=Math.floor(t/n),s=new Array(n).fill(r);let a=t-r*n;for(let t=0;t<n&&a>0;t++,a--)s[t]+=1;return s};if(!t&&g.length>0){if(g.map(t=>t.text||"").join("")===_){const t=[];for(const e of g){const n=Math.max(0,Math.round(e.duration||0)),r=Array.from(e.text||"");if(r.length<=0)continue;const s=Math.floor(n/r.length);let a=n-s*r.length;for(let e=0;e<r.length;e++){const e=s+(a>0?1:0);a>0&&a--,t.push(e)}}if(t.length!==w.length){m=b(g.reduce((t,e)=>t+Math.max(0,Math.round(e.duration||0)),0)||o,w.length).join(",")}else m=t.join(",")}else{m=b(g.reduce((t,e)=>t+Math.max(0,Math.round(e.duration||0)),0)||o,w.length).join(",")}}else m=String(o);s.push(`karaoke.add('${e(i)}', '${e(l)}', '${n(_)}', '${m}');`)}}const w=s.join("\n");return(new TextEncoder).encode(w).buffer}}const Kn=[[14,4,13,1,2,15,11,8,3,10,6,12,5,9,0,7,0,15,7,4,14,2,13,1,10,6,12,11,9,5,3,8,4,1,14,8,13,6,2,11,15,12,9,7,3,10,5,0,15,12,8,2,4,9,1,7,5,11,3,14,10,0,6,13],[15,1,8,14,6,11,3,4,9,7,2,13,12,0,5,10,3,13,4,7,15,2,8,15,12,0,1,10,6,9,11,5,0,14,7,11,10,4,13,1,5,8,12,6,9,3,2,15,13,8,10,1,3,15,4,2,11,6,7,12,0,5,14,9],[10,0,9,14,6,3,15,5,1,13,12,7,11,4,2,8,13,7,0,9,3,4,6,10,2,8,5,14,12,11,15,1,13,6,4,9,8,15,3,0,11,1,2,12,5,10,14,7,1,10,13,0,6,9,8,7,4,15,14,3,11,5,2,12],[7,13,14,3,0,6,9,10,1,2,8,5,11,12,4,15,13,8,11,5,6,15,0,3,4,7,2,12,1,10,14,9,10,6,9,0,12,11,7,13,15,1,3,14,5,2,8,4,3,15,0,6,10,10,13,8,9,4,5,11,12,7,2,14],[2,12,4,1,7,10,11,6,8,5,3,15,13,0,14,9,14,11,2,12,4,7,13,1,5,0,15,10,3,9,8,6,4,2,1,11,10,13,7,8,15,9,12,5,6,3,0,14,11,8,12,7,1,14,2,13,6,15,0,9,10,4,5,3],[12,1,10,15,9,2,6,8,0,13,3,4,14,7,5,11,10,15,4,2,7,12,9,5,6,1,13,14,0,11,3,8,9,14,15,5,2,8,12,3,7,0,4,10,1,13,11,6,4,3,2,12,9,5,15,10,11,14,1,7,6,0,8,13],[4,11,2,14,15,0,8,13,3,12,9,7,5,10,6,1,13,0,11,7,4,9,1,10,14,3,5,12,2,15,8,6,1,4,11,13,12,3,7,14,10,15,6,8,0,5,9,2,6,11,13,8,1,4,10,7,9,5,0,15,14,2,3,12],[13,2,8,4,6,15,11,1,10,9,3,14,5,0,12,7,1,15,13,8,10,3,7,4,12,5,6,11,0,14,9,2,7,11,4,1,9,12,14,2,0,6,10,13,15,3,5,8,2,1,14,7,4,10,8,13,15,12,9,0,3,5,6,11]];function Yn(t,e,n){const r=7-e%8;return(t[4*Math.floor(e/32)+3-Math.floor(e%32/8)]>>r&1)<<n>>>0}function qn(t,e,n){return(t>>31-e&1)<<n>>>0}function Qn(t,e,n){return(t<<e&2147483648)>>>n>>>0}function Gn(t){return 32&t|(31&t)>>1|(1&t)<<4}function Xn(t,e){const n=Qn(t,31,0)|(4026531840&t)>>>1|Qn(t,4,5)|Qn(t,3,6)|(251658240&t)>>>3|Qn(t,8,11)|Qn(t,7,12)|(15728640&t)>>>5|Qn(t,12,17)|Qn(t,11,18)|(983040&t)>>>7|Qn(t,16,23),r=Qn(t,15,0)|(61440&t)<<15|Qn(t,20,5)|Qn(t,19,6)|(3840&t)<<13|Qn(t,24,11)|Qn(t,23,12)|(240&t)<<11|Qn(t,28,17)|Qn(t,27,18)|(15&t)<<9|Qn(t,0,23),s=new Uint8Array(6);s[0]=n>>>24&255,s[1]=n>>>16&255,s[2]=n>>>8&255,s[3]=r>>>24&255,s[4]=r>>>16&255,s[5]=r>>>8&255;for(let t=0;t<6;t++)s[t]^=e[t];const a=new Uint8Array(8);a[0]=s[0]>>2,a[1]=(3&s[0])<<4|s[1]>>4,a[2]=(15&s[1])<<2|s[2]>>6,a[3]=63&s[2],a[4]=s[3]>>2,a[5]=(3&s[3])<<4|s[4]>>4,a[6]=(15&s[4])<<2|s[5]>>6,a[7]=63&s[5];let i=0;for(let t=0;t<8;t++)i|=(15&Kn[t][Gn(a[t])])<<4*(7-t);return(Qn(i,15,0)|Qn(i,6,1)|Qn(i,19,2)|Qn(i,20,3)|Qn(i,28,4)|Qn(i,11,5)|Qn(i,27,6)|Qn(i,16,7)|Qn(i,0,8)|Qn(i,14,9)|Qn(i,22,10)|Qn(i,25,11)|Qn(i,4,12)|Qn(i,17,13)|Qn(i,30,14)|Qn(i,9,15)|Qn(i,1,16)|Qn(i,7,17)|Qn(i,23,18)|Qn(i,13,19)|Qn(i,31,20)|Qn(i,26,21)|Qn(i,2,22)|Qn(i,8,23)|Qn(i,18,24)|Qn(i,12,25)|Qn(i,29,26)|Qn(i,5,27)|Qn(i,21,28)|Qn(i,10,29)|Qn(i,3,30)|Qn(i,24,31))>>>0}function Jn(t,e,n){const r=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1],s=[56,48,40,32,24,16,8,0,57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35],a=[62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,60,52,44,36,28,20,12,4,27,19,11,3],i=[13,16,10,23,0,4,2,27,14,5,20,9,22,18,11,3,25,7,15,6,26,19,12,1,40,51,30,36,46,54,29,39,50,44,32,47,43,48,38,55,33,52,45,41,49,35,28,31];let o=0,l=0,h=31;for(let e=0;e<28;e++)o|=Yn(t,s[e],h),h--;h=31;for(let e=0;e<28;e++)l|=Yn(t,a[e],h),h--;for(let t=0;t<16;t++){const s=r[t];o=4294967280&(o<<s|o>>>28-s),l=4294967280&(l<<s|l>>>28-s);const a=e[0===n?15-t:t];a.fill(0);for(let t=0;t<24;t++)a[t>>3]|=qn(o,i[t],7-t%8);for(let t=24;t<48;t++)a[t>>3]|=qn(l,i[t]-27,7-t%8)}}function Vn(t,e){const n=new Int32Array(2);!function(t,e){t[0]=Yn(e,57,31)|Yn(e,49,30)|Yn(e,41,29)|Yn(e,33,28)|Yn(e,25,27)|Yn(e,17,26)|Yn(e,9,25)|Yn(e,1,24)|Yn(e,59,23)|Yn(e,51,22)|Yn(e,43,21)|Yn(e,35,20)|Yn(e,27,19)|Yn(e,19,18)|Yn(e,11,17)|Yn(e,3,16)|Yn(e,61,15)|Yn(e,53,14)|Yn(e,45,13)|Yn(e,37,12)|Yn(e,29,11)|Yn(e,21,10)|Yn(e,13,9)|Yn(e,5,8)|Yn(e,63,7)|Yn(e,55,6)|Yn(e,47,5)|Yn(e,39,4)|Yn(e,31,3)|Yn(e,23,2)|Yn(e,15,1)|Yn(e,7,0)|0,t[1]=Yn(e,56,31)|Yn(e,48,30)|Yn(e,40,29)|Yn(e,32,28)|Yn(e,24,27)|Yn(e,16,26)|Yn(e,8,25)|Yn(e,0,24)|Yn(e,58,23)|Yn(e,50,22)|Yn(e,42,21)|Yn(e,34,20)|Yn(e,26,19)|Yn(e,18,18)|Yn(e,10,17)|Yn(e,2,16)|Yn(e,60,15)|Yn(e,52,14)|Yn(e,44,13)|Yn(e,36,12)|Yn(e,28,11)|Yn(e,20,10)|Yn(e,12,9)|Yn(e,4,8)|Yn(e,62,7)|Yn(e,54,6)|Yn(e,46,5)|Yn(e,38,4)|Yn(e,30,3)|Yn(e,22,2)|Yn(e,14,1)|Yn(e,6,0)|0}(n,t);for(let t=0;t<15;t++){const r=n[1];n[1]=Xn(n[1],e[t])^n[0]|0,n[0]=0|r}n[0]=Xn(n[1],e[15])^n[0]|0;const r=new Uint8Array(8);return function(t,e){e[3]=255&(qn(t[1],7,7)|qn(t[0],7,6)|qn(t[1],15,5)|qn(t[0],15,4)|qn(t[1],23,3)|qn(t[0],23,2)|qn(t[1],31,1)|qn(t[0],31,0)),e[2]=255&(qn(t[1],6,7)|qn(t[0],6,6)|qn(t[1],14,5)|qn(t[0],14,4)|qn(t[1],22,3)|qn(t[0],22,2)|qn(t[1],30,1)|qn(t[0],30,0)),e[1]=255&(qn(t[1],5,7)|qn(t[0],5,6)|qn(t[1],13,5)|qn(t[0],13,4)|qn(t[1],21,3)|qn(t[0],21,2)|qn(t[1],29,1)|qn(t[0],29,0)),e[0]=255&(qn(t[1],4,7)|qn(t[0],4,6)|qn(t[1],12,5)|qn(t[0],12,4)|qn(t[1],20,3)|qn(t[0],20,2)|qn(t[1],28,1)|qn(t[0],28,0)),e[7]=255&(qn(t[1],3,7)|qn(t[0],3,6)|qn(t[1],11,5)|qn(t[0],11,4)|qn(t[1],19,3)|qn(t[0],19,2)|qn(t[1],27,1)|qn(t[0],27,0)),e[6]=255&(qn(t[1],2,7)|qn(t[0],2,6)|qn(t[1],10,5)|qn(t[0],10,4)|qn(t[1],18,3)|qn(t[0],18,2)|qn(t[1],26,1)|qn(t[0],26,0)),e[5]=255&(qn(t[1],1,7)|qn(t[0],1,6)|qn(t[1],9,5)|qn(t[0],9,4)|qn(t[1],17,3)|qn(t[0],17,2)|qn(t[1],25,1)|qn(t[0],25,0)),e[4]=255&(qn(t[1],0,7)|qn(t[0],0,6)|qn(t[1],8,5)|qn(t[0],8,4)|qn(t[1],16,3)|qn(t[0],16,2)|qn(t[1],24,1)|qn(t[0],24,0))}(n,r),r}function tr(t,e,n){const r=Array.from({length:16},()=>new Uint8Array(6));Jn(e,r,n);const s=new Uint8Array(t.length);for(let e=0;e<t.length;e+=8){const n=t.subarray(e,Math.min(e+8,t.length));const a=Vn(8===n.length?n:(()=>{const t=new Uint8Array(8);return t.set(n),t})(),r);s.set(a.subarray(0,n.length),e)}return s}const er="9825B0ACE3028368E8FC6C";let nr="629F5B0900C35E95239F13117ED8923FBC90BB740EC347743D90AA3F51D8F411849FDE951DC3C609D59FFA66F9D8F0F7A090A1D6F3C3F3D6A190A0F7F0D8F966FA9FD509C6C31D95DE9F8411F4D8513FAA903D7447C30E74BB90BC3F92D87E11139F23955EC300095B9F6266A1D852F76790CAD64AC34AD6CA9067F752D8A166";const rr="!@#)(NHLiuy*$%^&",sr="123ZXC!@#)(*$%^&",ar="!@#)(*$%^&abcDEF";function ir(t){const e=t.replace(/\s+/g,"").toLowerCase();if(e.length%2!=0)throw new Error("非法 hex 长度");const n=new Uint8Array(e.length/2);for(let t=0;t<n.length;t++)n[t]=parseInt(e.substr(2*t,2),16);return n}function or(t){let e="";for(let n=0;n<t.length;n++){e+=t[n].toString(16).padStart(2,"0")}return e.toUpperCase()}function lr(t,e){let n=t.replace(/\s+/g,""),r=e.replace(/\s+/g,"");n.length%2!=0&&(n="0"+n),r.length%2!=0&&(r="0"+r);const s=ir(n),a=ir(r),i=new Uint8Array(s.length);for(let t=0;t<s.length;t++)i[t]=s[t]^a[t%a.length];return or(i)}function hr(t){return t.replace(/<[^>]+>/g,"")}function dr(t){return t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#39;/g,"'")}function cr(t){return/^[\s()]*$/.test(t)}function fr(t){const e=Math.floor(t/6e4),n=Math.floor(t%6e4/1e3),r=Math.floor(t%1e3);return`[${String(e).padStart(2,"0")}:${String(n).padStart(2,"0")}.${String(r).padStart(3,"0")}]`}class ur{static setXorKeyHex(t){nr=(t||"").replace(/\s+/g,"")}static parse(t,e){const n=new Uint8Array(e);let r=0;const s=Math.min(16,n.length);for(let t=0;t<s;t++){const e=n[t];(9===e||10===e||13===e||e>=32&&e<=126)&&r++}if(r>.8*s)throw new TypeError("非 QRC 二进制");let a=or(n);a.startsWith(er)&&(a=a.slice(22));const i=function(t){const e=(new TextEncoder).encode(rr).slice(0,8),n=(new TextEncoder).encode(sr).slice(0,8),r=(new TextEncoder).encode(ar).slice(0,8);let s=tr(t,e,0),a=tr(s,n,1);return tr(a,r,0)}(ir(lr(a,nr)));let o="";try{o=Mn(i,{to:"string"})}catch(t){try{o=$n(i,{to:"string"})}catch{throw t}}var l;if(o=(l=o||"")&&65279===l.charCodeAt(0)?l.slice(1):l,!o||!/<QrcInfos[>\s]/i.test(o))throw new SyntaxError("QRC 解密失败或内容无效");const d=function(t){const e=/<Lyric_\d+\b[^>]*?LyricContent="([\s\S]*?)"/i.exec(t);if(e&&e[1]){const t=[],n=dr(e[1]).split(/\r?\n/);for(const e of n){const n=e;if(/^\s*\[(ti|ar|al|by|offset):[^\]]*\]\s*$/i.test(n)){t.push(n.trim());continue}const r=/^\s*\[(\d+)\s*,\s*(\d+)\]\s*(.*)$/.exec(n);if(r){const e=parseInt(r[1],10),n=r[3]||"",s=fr(isFinite(e)?e:0),a=[],i=/\((\d+)\s*,\s*(\d+)\)/g;let o,l=0;for(;o=i.exec(n);){const t=n.slice(l,o.index),e=parseInt(o[2],10),r=isFinite(e)?Math.max(0,e):0,s=dr(t);cr(s)||a.push(`<${r}>${s.length?s:"​"}`),l=i.lastIndex}const h=dr(n.slice(l));t.push(s+a.join("")+(h&&!cr(h)?h:""));continue}n.trim()&&t.push(n)}return t.join("\n")}const n=[],r=/<([a-zA-Z_][\w\-]*)\b[^>]*?BeginTime="(\d+)"[^>]*?Duration="(\d+)"[^>]*>([\s\S]*?)<\/\1>/g;let s;for(;s=r.exec(t);){const t=parseInt(s[2]),e=s[4]||"",r=[],a=/<([a-zA-Z_][\w\-]*)\b[^>]*?(?:Duration|Len|Length)="(\d+)"[^>]*>([\s\S]*?)<\/\1>/g;let i;for(;i=a.exec(e);){const t=parseInt(i[2]),e=dr(hr(i[3]||"").trim());r.push({d:isFinite(t)?t:0,t:e})}const o=dr(hr(e).trim()),l=fr(t);if(r.length>0){const t=r.map(t=>`<${Math.max(0,t.d)}>​${t.t}`);n.push(`${l}${t.join("")}`)}else n.push(`${l}${o}`)}return n.join("\n")}(o);if(!d.trim())throw new SyntaxError("QRC 转换为空");h.parse(t,d)}}class _r{static generate(t){if(!(t instanceof gr))throw new TypeError("参数 1 必须为 Lyric 实例");const e=[],n=t=>(t||"").replace(/[\s\u200b]+/g,"");for(const r of t.lines){const t=!0===r.pseudoPerWord,s=Math.max(0,Math.round(r.startTime||0));let a=Math.round(r.duration||0);(!Number.isFinite(a)||a<0)&&(a=0);const i=r.rowTexts&&r.rowTexts.length>0?r.rowTexts:r.text?r.text.split("\n"):[""],o=(r.words||[]).filter(t=>!t.singleLine),l=n(o.map(t=>t.text||"").join(""));for(let h=0;h<i.length;h++){const d=h+1,c=i[h]||"";let f=t?[]:(r.words||[]).filter(t=>!t.singleLine&&(t?.lineNo||0)===d),u=c.includes("\n")?c.split("\n")[0]||"":c;if(f.length>0){const t=n(f.map(t=>t.text||"").join("")),e=n(u);if(t&&e&&t!==e){-1!==i.findIndex((e,r)=>r!==h&&n(e)===t)&&(f=[])}}0===f.length&&o.length>0&&l&&l===n(u)&&(f=o);let _="";if(!t&&f.length>0){let t=0,e="";const r=n(u);for(const s of f){const a=Math.max(0,Math.round(s.duration||0)),i=s.text&&s.text.length>0?s.text:"​",o=n(e+i);if(r&&o.length>r.length)break;if(r&&!r.startsWith(o))break;if(_+=`${i}(${t},${a})`,t+=a,e=o,r&&e.length===r.length)break}}else{_=`${u&&u.length>0?u:"​"}(0,${a})`}e.push(`[${s},${a}]${_}`)}}const r=e.join("\n"),s=`<?xml version="1.0" encoding="utf-8"?>\n<QrcInfos>\n  <Lyric_1 LyricContent="${a=r,(a||"").replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}"/>\n</QrcInfos>`;var a;let i=Fn(s);if(i.length%8!=0)for(let t=0;t<64;t++){const e=s+`\n\x3c!--p${"x".repeat(t+1)}--\x3e`,n=Fn(e);if(n.length%8==0){i=n;break}}const o=(t,e,n)=>{const r=Array.from({length:16},()=>new Uint8Array(6));Jn(e,r,n);const s=new Uint8Array(8*Math.ceil(t.length/8));let a=0;for(let e=0;e<t.length;e+=8){const n=t.subarray(e,Math.min(e+8,t.length));const i=Vn(8===n.length?n:(()=>{const t=new Uint8Array(8);return t.set(n),t})(),r);s.set(i,a),a+=8}return s},l=or((t=>{const e=(new TextEncoder).encode(rr).slice(0,8),n=(new TextEncoder).encode(sr).slice(0,8),r=(new TextEncoder).encode(ar).slice(0,8),s=o(t,r,1),a=o(s,n,0);return o(a,e,1)})(i));return ir(er+lr(l,nr)).buffer}}class gr{#p=new Map;#w=[];#m=new WeakSet;get metadata(){return this.#p}get lines(){return this.#w}get isEmpty(){return 0===this.#p.size&&0===this.#w.length}constructor(t){if(1!==arguments.length)throw new TypeError("参数数量必须为 1");if("object"!=typeof t||!(t instanceof ArrayBuffer))throw new TypeError("参数 1 必须为 ArrayBuffer 实例");this.#b();const e=[ur,Cn,Wn,h];for(let n=0;n<e.length;n++)try{if(e[n].parse(this,t),!this.isEmpty)return}catch{this.#b()}if(this.isEmpty)throw new SyntaxError}static async createFromUri(t){if(1!==arguments.length)throw new TypeError("参数数量必须为 1");if("string"!=typeof t)throw new TypeError("参数 1 必须为字符串");const e=await fetch(t),n=await e.arrayBuffer();return new gr(n)}static supportsPerWord(t){if(!t)return!1;if(!0===t.pseudoPerWord)return!0;if("function"==typeof t.hasPerWordTiming)return t.hasPerWordTiming();return(t.words||[]).some(t=>(t?.duration||0)>0&&!t.singleLine)}static generate(t,e){switch(e){case"lrc":return c.generate(t);case"trc":return d.generate(t);case"qrc":return _r.generate(t);case"krc":return Bn.generate(t);case"ksc":return Hn.generate(t);default:throw new TypeError("不支持的歌词格式："+e)}}setCurrentTime(e){if("number"!=typeof e||Number.isNaN(e)||!Number.isFinite(e)||e<0)throw new TypeError("参数 1 必须为非负数");const n=e+(("number"==typeof this.#p.get("offset")?this.#p.get("offset"):0)||0),r=this.#w;if(0===r.length)return{lineIndex:-1,wordIndex:-1};for(const e of r)if(!this.#m.has(e)){const n=e.words.map(e=>{const n=new t;return n.text=e.text,n.duration=e.duration,n.progress=e.progress,n.singleLine=e.singleLine,n.lineNo=e.lineNo,n.state=e.state??"future",n});e.words=n,this.#m.add(e)}let s=-1;if(n>=r[0].startTime){let t=0,e=r.length-1;for(;t<=e;){const a=t+e>>1;r[a].startTime<=n?(s=a,t=a+1):e=a-1}}let a=null;if(s<0)a=null;else{const t=r[s];a=n<t.startTime+t.duration?s:r.length}let i=null===a?0:a>=r.length?r.length-1:a,o=-1;for(let t=0;t<r.length;t++){const e=r[t];if(null!==a)if(a>=r.length){e.state="past",e.progress=1,e.renderProgress=gr.supportsPerWord(e)?0:1;for(const t of e.words)t.state="past",t.progress=1}else if(t<a){e.state="past",e.progress=1,e.renderProgress=gr.supportsPerWord(e)?0:1;for(const t of e.words)t.state="past",t.progress=1}else if(t===a){e.state="current",e.duration>0&&Number.isFinite(e.duration)?e.progress=Math.min(1,Math.max(0,(n-e.startTime)/e.duration)):e.progress=0,e.renderProgress=gr.supportsPerWord(e)?0:e.progress;let r=e.startTime;for(let t=0;t<e.words.length;t++){const s=e.words[t];if(s.singleLine){const t=e.startTime+e.duration;n<e.startTime?(s.state="future",s.progress=0):n>=t?(s.state="past",s.progress=1):(s.state="current",s.progress=Math.min(1,Math.max(0,(n-e.startTime)/(e.duration||1/0))))}else if(s.duration<=0){n<r?(s.state="future",s.progress=0):(s.state="past",s.progress=1)}else{const t=r,e=r+s.duration;n<t?(s.state="future",s.progress=0):n>=e?(s.state="past",s.progress=1):(s.state="current",s.progress=(n-t)/(s.duration||1))}r+=s.duration}if(t===i){const t=e.words;let n=t.findIndex(t=>"current"===t.state);if(-1===n&&t.length){for(let e=t.length-1;e>=0;e--)if("past"===t[e].state){n=e;break}-1===n&&(n=0)}o=n}}else{e.state="future",e.progress=0,e.renderProgress=0;for(const t of e.words)t.state="future",t.progress=0}else{e.state="future",e.progress=0,e.renderProgress=0;for(const t of e.words)t.state="future",t.progress=0}}return{lineIndex:i,wordIndex:o}}#b(){this.#p.clear(),this.#w.length=0,this.#m=new WeakSet}}export{e as LyricController,gr as default};